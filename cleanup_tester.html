<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SafarAI Speech Files Cleanup</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="icon" href="logo1.png" type="image/x-icon">
<style>
html, body {
    height: 100%;
    overflow: hidden;
}
body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #6e8efb, #a777e3);
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    position: relative;
    overflow: hidden;
}
.container {
    text-align: left;
    background: rgba(255, 255, 255, 0.12);
    padding: 24px;
    border-radius: 24px;
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.25), 0 4px 16px rgba(0, 0, 0, 0.15);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    width: min(95vw, 600px);
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 16px;
}
h1 {
    font-weight: 600;
    margin: 0 0 4px 0;
    font-size: 1.6rem;
}
.subtitle {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 4px;
}
.warning {
    font-size: 0.85rem;
    background: rgba(255, 193, 7, 0.15);
    border-radius: 12px;
    padding: 10px;
    border: 1px solid rgba(255, 193, 7, 0.6);
}
button {
    background: linear-gradient(135deg, #ff7675, #d63031);
    border: none;
    padding: 12px 22px;
    margin-top: 8px;
    color: white;
    font-size: 0.95rem;
    font-weight: 600;
    border-radius: 24px;
    cursor: pointer;
    transition: all 0.25s ease;
    align-self: flex-start;
}
button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}
button:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 6px 16px rgba(214, 48, 49, 0.5);
}
.status-pill {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 0.8rem;
    background: rgba(255, 255, 255, 0.12);
    border: 1px solid rgba(255, 255, 255, 0.25);
}
.status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
}
.status-ok {
    background: #00b894;
}
.status-error {
    background: #ff6b6b;
}
.log-box {
    margin-top: 6px;
    padding: 10px;
    border-radius: 12px;
    background: rgba(0, 0, 0, 0.25);
    border: 1px solid rgba(255, 255, 255, 0.15);
    font-size: 0.85rem;
    max-height: 260px;
    overflow: auto;
    white-space: pre-wrap;
}
</style>
</head>
<body>
<div class="container">
    <div>
        <h1>ðŸ§¹ Speech Files Cleanup</h1>
        <div class="subtitle">
            Call the cleanup endpoint to remove generated speech files from the server.
        </div>
        <div class="status-pill" id="statusPill">
            <span class="status-dot status-error" id="statusDot"></span>
            <span id="statusText">Idle â€“ no cleanup triggered yet</span>
        </div>
    </div>

    <div class="warning">
        This will delete generated audio files under <code>speechfiles/</code>. Make sure you have downloaded any files you want to keep before running the cleanup.
    </div>

    <button id="cleanupBtn" onclick="runCleanup()">Run Cleanup</button>

    <div class="log-box" id="logBox">
        No actions yet.
    </div>
</div>

<script>
const API_BASE = 'http://localhost:9999';

function setStatus(ok, text) {
    const dot = document.getElementById('statusDot');
    const pillText = document.getElementById('statusText');
    dot.className = 'status-dot ' + (ok ? 'status-ok' : 'status-error');
    pillText.textContent = text;
}

function appendLog(line) {
    const box = document.getElementById('logBox');
    if (box.textContent === 'No actions yet.') {
        box.textContent = '';
    }
    box.textContent += line + '\\n';
    box.scrollTop = box.scrollHeight;
}

async function runCleanup() {
    const btn = document.getElementById('cleanupBtn');
    btn.disabled = true;
    btn.textContent = 'Cleaning...';
    appendLog('Starting cleanup request...');
    setStatus(false, 'Sending cleanup request...');

    const start = performance.now();
    try {
        // Cleanup is exposed under del_speech_files router as GET /del-speech-files
        const response = await fetch(API_BASE + '/del-speech-files', {
            method: 'GET'
        });
        const elapsed = Math.round(performance.now() - start);

        if (!response.ok) {
            const textErr = await response.text();
            appendLog('HTTP ' + response.status + ': ' + textErr);
            setStatus(false, 'Cleanup failed (' + elapsed + ' ms)');
        } else {
            const data = await response.json().catch(() => ({}));
            appendLog('Cleanup finished. Response: ' + JSON.stringify(data));
            setStatus(true, 'Cleanup successful (' + elapsed + ' ms)');
        }
    } catch (err) {
        appendLog('Error: ' + err.message);
        setStatus(false, 'Cleanup error');
    } finally {
        btn.disabled = false;
        btn.textContent = 'Run Cleanup';
    }
}
</script>
</body>
</html>


